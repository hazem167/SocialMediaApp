<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media</title>
    <link rel="stylesheet" href="master.css">
    <!-- import BootStrap -->
     <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
     <!-- JavaSCript Logic -->
    </head>
    <body>
         <!-- Loader  -->
     <div id="loader" class="shadow" >
     <div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
    </div>
    <!-- Loader  -->

         <!-- Modals  -->
   <!-- Login Modal  -->
   
   <div class="modal fade" id="LoginModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
       <div class="modal-dialog">
           <div class="modal-content">
               <div class="modal-header">
                   <h1 class="modal-title fs-5" id="exampleModalLabel">Login Form</h1>
                   <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="username-input" class="col-form-label">Username:</label>
                            <input type="text" class="form-control" id="username-input">
                        </div>
                        <div class="mb-3">
                            <label for="password-input" class="col-form-label">password:</label>
                            <input type="password" class="form-control" id="password-input">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="login-btn">Login</button>
                </div>
            </div>
        </div>
    </div>
    <!-- End Logain Modal  -->
     <!-- ====================== -->
    <!-- Register Start Model  -->
    <div class="modal fade" id="register-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Register A New User</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="register-image-input" class="col-form-label">image:</label>
                            <input type="file" class="form-control" id="register-image-input">
                        </div>
                        <!-- For Name only  -->
                        <div class="mb-3">
                            <label for="register-name-input" class="col-form-label">Name:</label>
                            <input type="text" class="form-control" id="register-name-input">
                        </div>
                        <!-- For user Name  -->
                        <div class="mb-3">
                            <label for="register-username-input" class="col-form-label">Username:</label>
                            <input type="text" class="form-control" id="register-username-input">
                        </div>
                            <div class="mb-3">
                                <label for="register-password-input" class="col-form-label">password:</label>
                                <input type="password" class="form-control" id="register-password-input">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="register-btn">Register</button>
                    </div>
                </div>
            </div>
        </div>
        <!--End Register Modal  -->
        <!-- ================================ -->
        <!-- Craete post button modal  -->
        <div class="modal fade" id="CreatePostModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="post-modal-title">Create New Post</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <!-- For Name only  -->
                            <div class="mb-3">
                                <label for="post-title-input" class="col-form-label">Title:</label>
                                <input type="text" class="form-control" id="post-title-input">
                                <input type="hidden" name="" id="post-id-input" value="">
                            </div>
                            <div class="mb-3">
                                <textarea name="" id="post-body-input" style="width: 100%; height: 70px; border-radius: 10px; resize: none; padding: 5px;"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="post-image-input" class="col-form-label">image:</label>
                                <input type="file" class="form-control" id="post-image-input">
                            </div>
                            
                            
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button onclick="createNewpost()" id="post-modal-submit-btn" type="button" class="btn btn-primary" id="Create-btn">Create</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Craete post button modal  -->
        <!-- Delete post button modal  -->
        <div class="modal fade" id="DeletePostModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="post-modal-title">Are you sure you want to delete post 
                            <span id="Delete-post-title"></span>
                        </h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        <input type="hidden" id="delete-post-id-input" value="">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button onclick="ConfirmPostDelete()" id="post-modal-submit-btn" type="button" class="btn btn-danger" id="Create-btn">Delete</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Delete post button modal  -->

        <!-- Add post button  -->
        <div class="bg-primary " id="add-button" onclick="addBtnclicked()">+</div>
        
        
        
        
        
        
        
        <!-- alert and the function showacces alert will fill it ,fade and show to smooth the alert  -->
        <div id="succesAlert" class="fade show" style="position: fixed; z-index: 9999; width: 30%; bottom: 0;right: 0;"></div>
        <!-- Endalert  -->
        <!--ENd  Modals  -->
           <!-- NavBar container  -->
        <div class="container pt-2">
            <div class="d-flex justify-content-center">
                <div class="col-9">
                    <nav class="navbar navbar-expand-lg shadow rounded bg-light ">
                        <div class="container-fluid">
                     <a class="navbar-brand bg-primary bg-gradient p-2 rounded" href="home.html">ChatUs</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse " id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="home.html">Home</a>
                    </li>
                  <li class="nav-item">
                        <a class="nav-link" onclick="profileCLicked()" style="cursor: pointer;">Profile</a>
                    </li>
                </ul>
            </div>
            <!--  non logged for user  -->
            <div class="d-flex w-100 justify-content-end bg-light " id="logged-div">
                <button id="Login-home-btn" type="button" data-bs-toggle="modal" data-bs-target="#LoginModal" class="btn btn-outline-success">Login</button>
                <button id="Register-home-btn" type="button" data-bs-toggle="modal" data-bs-target="#register-modal" class="btn btn-outline-success mx-3">Register</button>
            </div>
            <!-- End for non logged user  -->
            <!-- for logged user  -->
            <div class="d-flex w-100 justify-content-end bg-light align-items-center " id="Logout-div">
                <img src="profoil-pics/user-307993_1280.png" alt="" class="rounded-circle mx-2 forevery-img" id="nav-user-image">
                <b id="nav-userName">
                    @Hazem
                </b>
                <button id="Logout-btn" type="button" data-bs-toggle="modal"  class="btn btn-outline-danger mx-3">Logout</button>
            </div>
        </nav>
    </div>
</div>
</div>
<!-- NavBar container  -->
<!-- Main Content  -->
        <div class="container">
            <div class="d-flex justify-content-center mt-5">
                <div class="col-9">
                    <!-- Main Info -->
                     <div class="card shadow">
                         <div class="card-body">
                             <div class="row">
                                <!-- user image column -->
                                <div class="col-2">
                                    <img  class="border border-black p-1 forevery-img" style="width: 80px; height: 80px; border-radius: 200px !important;" id="header-image" src="./profoil-pics/user-307993_1280.png" alt="">
                                </div>
                                <!-- user image column -->
                                 <!-- UserName and Email Name -->
                                  <div  class="col-4 d-flex flex-column justify-content-evenly" style="font-weight: bold;">
                                    <div  id="main-info-emai">
                                        Hazem@gmai.com
                                    </div>
                                    <div id="main-info-userName">
                                        UserName
                                    </div>
                                    <div id="main-info-name">
                                        Name
                                    </div>
                                  </div>
                                 <!-- UserName and Email Name -->
                                <!-- Post and comment count  -->
                                 <div class="col-4 d-flex flex-column justify-content-evenly">
                                    <div class="number-info text-black-50">
                                        <span id="posts-count">13</span>post
                                    </div>
                                    <div class="number-info text-black-50">
                                        <span id="commnet-count">13</span>commnets
                                    </div>
                                </div>
                                <!-- Post and comment count  -->
                        </div>
                    </div>
                </div>
                <!-- Main Info  -->
                 <!-- Posts  -->
                 <div class="row" id="user-posts">

                 </div>
                 <!-- Posts  -->

                   
                
            </div>
        </div>
                    
                   
                           
                                   
                  
           



        
    </body>
<script src="./node_modules/bootstrap/dist/js/bootstrap.bundle.min.js" ></script>
<script src="./Logic/main.js" ></script>
<script src="./node_modules/axios/dist/axios.min.js"></script>
<script >
    setupUI();
    getUser();
    getPostsforSpecifcUser();
    function getcurrentUserIdfromUrl(){
        const urlParam=new URLSearchParams(window.location.search);
        const id =urlParam.get("userid");;
        return id;
    }
    //To fill the above section 
    function getUser(){

        const id =getcurrentUserIdfromUrl();
        axios.get(`${baseurl}users/${id}`).then((response)=>{
            const user=response.data.data;
            document.getElementById("main-info-emai").innerHTML=user.email;
            document.getElementById("main-info-userName").innerHTML=user.username;
            document.getElementById("main-info-name").innerHTML=user.name;
            document.getElementById("posts-count").innerHTML=user.posts_count;
            document.getElementById("commnet-count").innerHTML=user.comments_count;
            document.getElementById("header-image").src=user.profile_image;

        })
    }
    
    
    
function getPostsforSpecifcUser() {
        const id =getcurrentUserIdfromUrl();
        axios.get(`${baseurl}users/${id}/posts`).then((response) => {
            const posts = response.data.data;
            for (const post of posts) {
                
                //To show or Hide Edit button
                let user=getCurrentUser();
                let isMyPost=user!=null&&post.author.id ==user.id;
                let buttonContentforEdit=``;
                if(isMyPost){
                    buttonContentforEdit=`
                     <button class="btn btn-secondary" style="float:right" onclick="EditPostButton('${encodeURIComponent(JSON.stringify(post))}')">Edit</button>
                     <button class="btn btn-danger mx-2" style="float:right" onclick="DeletePostButton('${encodeURIComponent(JSON.stringify(post))}')">Delete</button>
                     
                     `;
                     
                    }
                    //To show or Hide Edit button
    
                    let content = `
                    <div class="d-flex justify-content-center mt-5">
                        <div class="col-9 position-relative">
                            <div class="card shadow" >
                                <div class="card-header">
                                    <img src="${post.author.profile_image
                                    }" alt="" class="rounded-circle border border-4 forevery-img">
                                    <b>@${post.author.username}</b>
                                    ${buttonContentforEdit}
                                        </div>
                                        <div class="card-body"onclick="PostClick(${post.id})">
                                            <img src="${post.image}" alt="" class="w-100 ">
                                            <h6 class="text-black-50 mt-1 px-1">${post.created_at
                                                }</h6>
                                                <h5>${post.title != null ? post.title : (post.title = "")
                                                    }</h5>
                                <p>${post.body}</p>
                                <hr>
                                <div class="body-footer">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil"
                                    viewBox="0 0 16 16">
                                    <path
                                    d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325" />
                                    </svg>
                                    <span>(${post.comments_count}) commnets</span>
                                    <span id="post-tags-${post.id}">
                                        
                                        </span>
                                        </div>
                                        </div>
                                        </div>
                                        </div>
                                        </div>
                                        `;
                                        document.getElementById("user-posts").innerHTML += content;
                                        const currentPostTagId = `post-tags-${post.id}`;
                                        document.getElementById(currentPostTagId).innerHTML = "";
                                        
                                        for (const tag of post.tags) {
                                            let tagscontent = `
                            <button class="btn-sm rounded-5 btn" style="background-color:gray; color:white;">
                                ${tag.name}
                                </button>
                                `;
                                document.getElementById(currentPostTagId).innerHTML += tagscontent;
                            }
            
           
            
        }
    }).finally(() => {
    toggleLoader(false);
    })
}

</script>
</html>